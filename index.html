<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Snake 2025 ‚Äì Neon Edition</title>

  <!-- Farcaster Frame SDK -->
  <script src="https://unpkg.com/@farcaster/frame-sdk/dist/sdk.js"></script>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #fff;
      margin: 0;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
      color: #111;
    }

    #home {
      text-align: center;
      animation: fadeIn 1s;
    }

    h1 {
      font-size: 2.5em;
      margin-bottom: 0.4em;
      background: linear-gradient(90deg, #111, #00c06f);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    button {
      background: #00c06f;
      border: none;
      color: white;
      font-size: 1.1em;
      padding: 12px 28px;
      border-radius: 10px;
      margin: 8px;
      cursor: pointer;
      transition: 0.2s;
    }

    button:hover {
      transform: scale(1.05);
      box-shadow: 0 0 12px #00c06f;
    }

    #gameContainer {
      display: none;
      flex-direction: column;
      align-items: center;
    }

    canvas {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 0 20px rgba(0, 192, 111, 0.3);
    }

    #scoreBoard {
      margin-top: 10px;
      font-size: 1.1em;
      font-weight: 600;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
  </style>
</head>

<body>
  <!-- Home Screen -->
  <div id="home">
    <h1>üêç Snake 2025</h1>
    <p>Select your difficulty</p>
    <button onclick="startGame('easy')">Easy</button>
    <button onclick="startGame('medium')">Medium</button>
    <button onclick="startGame('hard')">Hard</button>
    <p style="margin-top:20px; font-size:0.9em; color:#555;">Built for Base ‚Ä¢ Play on Farcaster</p>
  </div>

  <!-- Game Screen -->
  <div id="gameContainer">
    <canvas id="game" width="400" height="400"></canvas>
    <div id="scoreBoard">
      üßÆ Score: <span id="score">0</span> |
      üèÜ High Score: <span id="highscore">0</span>
    </div>
    <button onclick="backToMenu()">üè† Back</button>
  </div>

  <script>
    let canvas = document.getElementById("game");
    let ctx = canvas.getContext("2d");
    const box = 20;
    let snake = [{ x: 9 * box, y: 10 * box }];
    let direction = null;
    let food = randomFood();
    let score = 0;
    let speed = 180;
    let game;
    let paused = false;

    const eatSound = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-quick-win-video-game-notification-269.wav");
    const crashSound = new Audio("https://assets.mixkit.co/sfx/preview/mixkit-arcade-retro-game-over-213.wav");

    const scoreElem = document.getElementById("score");
    const highElem = document.getElementById("highscore");
    const home = document.getElementById("home");
    const gameContainer = document.getElementById("gameContainer");

    // Difficulty Settings
    const difficultySpeeds = { easy: 160, medium: 120, hard: 80 };

    function randomFood() {
      return {
        x: Math.floor(Math.random() * 20) * box,
        y: Math.floor(Math.random() * 20) * box,
      };
    }

    document.addEventListener("keydown", directionSet);
    function directionSet(event) {
      if (event.keyCode == 37 && direction != "RIGHT") direction = "LEFT";
      if (event.keyCode == 38 && direction != "DOWN") direction = "UP";
      if (event.keyCode == 39 && direction != "LEFT") direction = "RIGHT";
      if (event.keyCode == 40 && direction != "UP") direction = "DOWN";
    }

    function startGame(diff) {
      home.style.display = "none";
      gameContainer.style.display = "flex";
      score = 0;
      direction = null;
      snake = [{ x: 9 * box, y: 10 * box }];
      speed = difficultySpeeds[diff];
      food = randomFood();
      clearInterval(game);
      game = setInterval(draw, speed);
    }

    function backToMenu() {
      clearInterval(game);
      gameContainer.style.display = "none";
      home.style.display = "block";
    }

    function draw() {
      ctx.clearRect(0, 0, 400, 400);
      // background gradient
      const bg = ctx.createLinearGradient(0, 0, 400, 400);
      bg.addColorStop(0, "#ffffff");
      bg.addColorStop(1, "#f7fff9");
      ctx.fillStyle = bg;
      ctx.fillRect(0, 0, 400, 400);

      // draw food
      const foodGlow = ctx.createRadialGradient(food.x + box / 2, food.y + box / 2, 2, food.x + box / 2, food.y + box / 2, 14);
      foodGlow.addColorStop(0, "#ffb200");
      foodGlow.addColorStop(1, "rgba(255,178,0,0)");
      ctx.fillStyle = foodGlow;
      ctx.beginPath();
      ctx.arc(food.x + box / 2, food.y + box / 2, box / 2 - 2, 0, Math.PI * 2);
      ctx.fill();

      // draw snake
      for (let i = 0; i < snake.length; i++) {
        const alpha = 1 - i / snake.length;
        const color = `rgba(10,10,10,${0.8 + alpha * 0.3})`; // dark neon feel
        const glow = ctx.createRadialGradient(
          snake[i].x + box / 2,
          snake[i].y + box / 2,
          2,
          snake[i].x + box / 2,
          snake[i].y + box / 2,
          12
        );
        glow.addColorStop(0, color);
        glow.addColorStop(1, "rgba(0,0,0,0)");
        ctx.fillStyle = glow;
        ctx.beginPath();
        ctx.arc(snake[i].x + box / 2, snake[i].y + box / 2, box / 2, 0, Math.PI * 2);
        ctx.fill();
      }

      let headX = snake[0].x;
      let headY = snake[0].y;
      if (direction === "LEFT") headX -= box;
      if (direction === "UP") headY -= box;
      if (direction === "RIGHT") headX += box;
      if (direction === "DOWN") headY += box;

      if (headX === food.x && headY === food.y) {
        score++;
        eatSound.play();
        food = randomFood();
      } else {
        snake.pop();
      }

      const newHead = { x: headX, y: headY };
      if (headX < 0 || headY < 0 || headX >= 400 || headY >= 400 || collision(newHead, snake)) {
        crashSound.play();
        clearInterval(game);
        saveScore(score);
        alert("üí• Game Over! Your score: " + score);
        backToMenu();
      }

      snake.unshift(newHead);
      scoreElem.textContent = score;
      let high = localStorage.getItem("highscore") || 0;
      if (score > high) localStorage.setItem("highscore", score);
      highElem.textContent = localStorage.getItem("highscore");
    }

    function collision(head, arr) {
      for (let i = 0; i < arr.length; i++) {
        if (head.x == arr[i].x && head.y == arr[i].y) return true;
      }
      return false;
    }

    function saveScore(s) {
      let high = localStorage.getItem("highscore") || 0;
      if (s > high) localStorage.setItem("highscore", s);
    }

    // Farcaster SDK init
    window.addEventListener("DOMContentLoaded", async () => {
      try {
        const sdk = await window.FarcasterFrameSDK.init();
        sdk.actions.ready(); // ‚úÖ tell Warpcast the app is ready
        console.log("‚úÖ Farcaster Mini-App Ready");
      } catch (e) {
        console.log("‚ö†Ô∏è Running standalone");
      }
    });
  </script>
</body>
</html>
