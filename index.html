<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Snake 2025 ‚Äî Neon Ultra+</title>
<style>
  :root{
    --white:#ffffff; --panel:#f8fff8;
    --neon:#00b36b; --neon-2:#00cca0; --accent:#ffd166;
    --text:#07331f; --muted:rgba(7,51,31,0.6);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, "Courier New", monospace;}
  body{
    display:flex;align-items:center;justify-content:center;flex-direction:column;background:var(--white);
    color:var(--text);overflow:hidden;padding:20px;
  }
  h1{color:var(--neon); text-shadow:0 0 10px rgba(0,179,107,0.18); margin:10px 0 14px 0}

/* Layout */
  #container{width:min(92vw,700px); max-width:100%; display:flex; gap:18px; align-items:flex-start; justify-content:center; flex-wrap:wrap;}
  #wrap{position:relative; width:min(88vw,540px);}

/* Canvas */
  canvas{width:100%; height:auto; display:block; border-radius:12px;
    box-shadow:0 12px 30px rgba(0,0,0,0.06); border:1px solid rgba(0,0,0,0.05);
    background: linear-gradient(180deg,#ffffff,#f7fff7);}

/* Panels */
  .panel{background:var(--panel); padding:14px; border-radius:10px; border:1px solid rgba(7,51,31,0.06);
    box-shadow:0 8px 30px rgba(7,51,31,0.04); color:var(--text);}
  .menu{width:300px;}
  .controls{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; justify-content:center}
  button, select { background:#f0fff4; color:var(--text); border:1px solid rgba(0,179,107,0.12); padding:8px 12px; border-radius:8px; cursor:pointer; font-family:inherit; }
  button:hover{transform:translateY(-2px); box-shadow:0 10px 20px rgba(0,179,107,0.06);}

/* HUD */
  #hud{display:flex; gap:10px; align-items:center; justify-content:space-between; width:100%; margin-top:12px}
  #scoreBox{font-family:inherit; color:var(--text); font-size:1rem}

/* Leaderboard list */
  ol#leader{padding-left:18px; margin:8px 0}
  ol#leader li{padding:6px 6px; border-bottom:1px dashed rgba(0,0,0,0.04)}

/* overlays & vis */
  .overlay{position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); width:88%; max-width:420px; z-index:30}
  .hidden{display:none}

/* mobile small */
  @media(max-width:520px){
    .menu{width:100%}
    #wrap{width:94vw}
    .controls{gap:6px}
  }

/* small text */
  .muted{font-size:12px;color:var(--muted); text-align:center; margin-top:8px}
</style>
</head>
<body>
  <h1>Snake 2025 ‚Äî Neon Ultra+</h1>

  <div id="container">
    <div id="wrap">
      <canvas id="canvas" width="480" height="480"></canvas>

      <!-- Start Menu (overlay) -->
      <div class="overlay panel" id="menuPanel">
        <h2 style="text-align:center;margin:0 0 6px 0">Play</h2>
        <div style="text-align:center; font-size:0.95rem; color:var(--muted)">Choose difficulty & color, then start</div>

        <div class="controls" style="margin-top:12px">
          <div style="text-align:left">
            <label style="display:block;margin-bottom:6px">Difficulty</label>
            <select id="difficulty">
              <option value="160">Easy</option>
              <option value="110" selected>Medium</option>
              <option value="70">Hard</option>
            </select>
          </div>

          <div style="text-align:left">
            <label style="display:block;margin-bottom:6px">Snake color</label>
            <select id="snakeColor">
              <option value="#00b36b">Neon Green</option>
              <option value="#00b3b3">Cyan</option>
              <option value="#e055aa">Magenta</option>
              <option value="#ffb547">Amber</option>
            </select>
          </div>
        </div>

        <div class="controls" style="margin-top:14px">
          <button id="startBtn">‚ñ∂Ô∏è Start Game</button>
          <button id="leaderBtn">üèÜ Leaderboard</button>
          <button id="howBtn">‚ùì How to Play</button>
        </div>

        <div class="muted">Tip: Arrow keys (desktop) or swipe (mobile). Press P to pause.</div>
      </div>

      <!-- Leaderboard overlay -->
      <div class="overlay panel hidden" id="leaderPanel">
        <h2 style="text-align:center;margin:0 0 6px 0">Leaderboard</h2>
        <ol id="leader"></ol>
        <div class="controls" style="margin-top:10px; justify-content:center">
          <button id="backBtn">Back</button>
          <button id="clearBtn" title="Clear local leaderboard">Reset</button>
        </div>
      </div>

      <!-- Game Over overlay -->
      <div class="overlay panel hidden" id="overPanel">
        <h2 style="text-align:center;margin:0 0 6px 0">Game Over</h2>
        <div id="finalText" style="text-align:center; margin-bottom:8px"></div>
        <div class="controls" style="justify-content:center">
          <button id="replayBtn">üîÅ Play Again</button>
          <button id="homeBtn">üè† Home</button>
        </div>
      </div>

    </div>

    <!-- side menu panel -->
    <div class="panel menu">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:700">Controls</div>
        <div style="font-size:0.85rem;color:var(--muted)">White theme</div>
      </div>

      <div style="margin-top:10px">
        <div style="display:flex; gap:8px; align-items:center">
          <button id="pauseBtn">‚è∏ Pause</button>
          <button id="musicBtn">üéµ Music: On</button>
          <button id="muteBtn">üîà Mute FX</button>
        </div>

        <div id="hud" style="margin-top:12px">
          <div id="scoreBox">Score: 0 | High: 0</div>
        </div>

        <div style="margin-top:12px">
          <div style="font-weight:600; margin-bottom:6px">About</div>
          <div class="muted">Local leaderboard. Saved in your browser. Deploy to Vercel and paste the URL into Farcaster for a frame preview.</div>
        </div>
      </div>
    </div>
  </div>

  <div style="margin-top:12px" class="muted">Made for Farcaster / Base ‚Äî static site on Vercel</div>

  <!-- Audio -->
  <audio id="sfxEat" src="https://assets.mixkit.co/sfx/preview/mixkit-retro-game-notification-212.wav"></audio>
  <audio id="sfxCrash" src="https://assets.mixkit.co/sfx/preview/mixkit-player-losing-or-failing-2042.wav"></audio>
  <audio id="sfxClick" src="https://assets.mixkit.co/sfx/preview/mixkit-modern-click-box-check-1120.wav"></audio>
  <audio id="bgMusic" loop src="https://assets.mixkit.co/music/preview/mixkit-80s-retrowave-1121.mp3"></audio>

<script>
/* ----- Elements ----- */
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

const menuPanel = document.getElementById('menuPanel');
const leaderPanel = document.getElementById('leaderPanel');
const overPanel = document.getElementById('overPanel');

const leaderEl = document.getElementById('leader');
const finalText = document.getElementById('finalText');

const scoreBox = document.getElementById('scoreBox');
const difficultyEl = document.getElementById('difficulty');
const colorEl = document.getElementById('snakeColor');

const sEat = document.getElementById('sfxEat');
const sCrash = document.getElementById('sfxCrash');
const sClick = document.getElementById('sfxClick');
const bgMusic = document.getElementById('bgMusic');

const startBtn = document.getElementById('startBtn');
const leaderBtn = document.getElementById('leaderBtn');
const howBtn = document.getElementById('howBtn');

const backBtn = document.getElementById('backBtn');
const clearBtn = document.getElementById('clearBtn');
const replayBtn = document.getElementById('replayBtn');
const homeBtn = document.getElementById('homeBtn');

const pauseBtn = document.getElementById('pauseBtn');
const musicBtn = document.getElementById('musicBtn');
const muteBtn = document.getElementById('muteBtn');

/* ----- State & settings ----- */
let settings = {
  color: localStorage.getItem('snake_color') || '#00b36b',
  difficulty: localStorage.getItem('snake_diff') || '110',
  musicOn: localStorage.getItem('snake_music') !== 'false',
  fxOn: localStorage.getItem('snake_fx') !== 'false'
};
colorEl.value = settings.color;
difficultyEl.value = settings.difficulty;
bgMusic.volume = 0.35;

let grid = 24;
let box = 20;
let snake = [];
let dir = null;
let food = null;
let score = 0;
let highScore = Number(localStorage.getItem('snake_high') || 0);
let leaderboard = JSON.parse(localStorage.getItem('snake_leader') || '[]');
let running = false;
let paused = false;
let interval = Number(settings.difficulty || 110);
let particles = [];
let lastTime = 0;
let accumulator = 0;
let shake = 0;

/* responsive */
function fitCanvas(){
  canvas.width = 480; canvas.height = 480; box = Math.floor(canvas.width / grid);
}
fitCanvas(); window.addEventListener('resize', fitCanvas);

/* util */
function randGrid(){
  const max = grid - 2;
  return { x: (1 + Math.floor(Math.random()*max)) * box, y: (1 + Math.floor(Math.random()*max)) * box };
}
function saveSettings(){
  localStorage.setItem('snake_color', colorEl.value);
  localStorage.setItem('snake_diff', difficultyEl.value);
  localStorage.setItem('snake_music', settings.musicOn ? 'true' : 'false');
  localStorage.setItem('snake_fx', settings.fxOn ? 'true' : 'false');
}

/* sounds */
function playFX(sound){
  if(!settings.fxOn) return;
  try{ sound.currentTime = 0; sound.play(); } catch(e){}
}
function toggleMusic(){
  settings.musicOn = !settings.musicOn;
  if(settings.musicOn) bgMusic.play(); else bgMusic.pause();
  musicBtn.innerText = settings.musicOn ? 'üéµ Music: On' : 'üéµ Music: Off';
  saveSettings();
}
function toggleFX(){
  settings.fxOn = !settings.fxOn;
  muteBtn.innerText = settings.fxOn ? 'üîà Mute FX' : 'üîà FX Off';
  saveSettings();
}

/* particles */
function spawnParticle(x,y,color,life=700,count=8,speed=1.4){
  for(let i=0;i<count;i++){
    const a = Math.random()*Math.PI*2;
    const sp = (Math.random()*0.6+0.4) * speed;
    particles.push({ x:x+box/2, y:y+box/2, vx:Math.cos(a)*sp, vy:Math.sin(a)*sp, color, life, age:0, size:(Math.random()*3)+1 });
  }
}
function updateParticles(dt){
  for(let i=
